<!DOCTYPE HTML>
<html>
<head>
   <title>User Access Control</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "html_sampleuseraccesscontrol.htm");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body style="margin: 0px 0px 0px 0px; background: #FFFFFF;">

<table width="100%" border="0" cellspacing="0" cellpadding="10">
  <tr valign="middle" bgcolor="#99CCFF">
    <td>
      <p>
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td style="vertical-align:middle;">
              <p style="font-family:Verdana; font-size:9pt; font-style:italic;">OPC UA C++ Server &amp; Client SDK V6.00</p>
              <p style="font-family:Verdana; font-size:9pt; font-weight:bold;">User Access Control</p>
            </td>
          </tr>
        </table>
      </p>
    </td>
    <td align="right">
     <span style="font-size: 9pt">
     <a href="html_welcome.htm">Top</a>&nbsp;
     <a href="html_samplelimitedresources.htm">Previous</a>&nbsp;
     <a href="html_sampleasynchronousaccess.htm">Next</a>
     </span>
    </td>
  </tr>
  <tr bgcolor="white">
      <td colspan="2">
          <p class="p_Paragraph"><a id="hdr"></a><span class="f_Paragraph">This sample show how to identify different users and how to configure specific access to different users.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">It contains a server and a client application which use different user authentication tokens for identification.</span><br />
<span class="f_Paragraph">The sample implements token types &quot;Username / Password&quot; and &quot;User Certificates&quot;.</span><br />
<span class="f_Paragraph">Additionally the token type &quot;Issued Token&quot; can be used, but this is not part of this sample.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">The OPC UA C++ Server &amp; Client SDK V6.00 provides support to validate certificates in general including user certificates.</span><br />
<span class="f_Paragraph">Validation includes </span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Certificate (or signing CA) in trusted user certificate store</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Certificate is valid in time</span></td></tr></table></div><p class="p_Paragraph"><span class="f_Paragraph">However OPC UA C++ Server &amp; Client SDK V6.00 gives no support to create user certificates or extract user information from a certificate.</span></p>
<h3 class="p_Heading3"><span class="f_Heading3">Where to Find</span></h3>
<p class="p_Paragraph"><span class="f_Paragraph">The sample projects are located in the directory: &quot;</span><span class="f_FixedSize">&lt;InstallDir&gt;/Apps/Samples/Cpp/UserAccessControl</span><span class="f_Paragraph">&quot;. The client is in the subdirectory &quot;</span><span class="f_FixedSize">UserAccessControlClient</span><span class="f_Paragraph">&quot; and the server is in the &quot;</span><span class="f_FixedSize">UserAccessControlServer</span><span class="f_Paragraph">&quot; subdirectory.</span></p>
<h3 class="p_Heading3"><span class="f_Heading3">Running the Sample</span></h3>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">The client and server need an existing application instance certificate and it must be in the correct directory. See <a href="html_setupcertificates.htm" class="topiclink">Setting up a Certificate Store</a> for how to create the demo certificate store. The path to the certificate is specified at the top of </span><span class="f_FixedSize">UserAccessControlServer.cpp </span><span class="f_Paragraph">and</span><span class="f_FixedSize"> UserAccessControlClient.cpp</span><span class="f_Paragraph">, adapt it if it doesn't fit.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Compile and start the sample applications </span><span class="f_Reference">UserAccessControlClient</span><span class="f_Paragraph"> and </span><span class="f_Reference">UserAccessControlServer</span><span class="f_Paragraph">. Run the application of interest in the debugger and step through the code.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Type on the client the command &quot;</span><span class="f_FixedSize">co</span><span class="f_Paragraph">&quot; (connect) followed by a number to connect as a predefined user with a certain user authentication token.</span><br />
<span class="f_Paragraph">After that the commands &quot;</span><span class="f_FixedSize">rd</span><span class="f_Paragraph">&quot; (read) and &quot;</span><span class="f_FixedSize">wr</span><span class="f_Paragraph">&quot; (write) can be used to access some configured variables. </span><br />
<span class="f_Paragraph">Depending on the access rights of the connected user and the access type (read or write), some of these access calls may fail. </span><br />
<span class="f_Paragraph">Disconnect with the command &quot;</span><span class="f_FixedSize">di</span><span class="f_Paragraph">&quot; to be able to connect again as another user.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">When connected use the &quot;</span><span class="f_FixedSize">br</span><span class="f_Paragraph">&quot; command to browse the parent folder and list all the variables. Considering the configured role permissions some variables are not visible for Anonymous Role.</span></td></tr></table></div><h3 class="p_Heading3"><span class="f_Heading3">Points of Interest</span></h3>
<p class="p_Paragraph"><span class="f_Paragraph">Client:</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">How to select and connect to an <a href="class_softing_o_p_c_toolbox5_1_1_server_1_1_endpoint.htm" class="topiclink">Endpoint</a> that has the desired user token policy. (See UserAccessControlClient::connect())</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Setting the username and password or user certificate for authentication. (See UserAccessControlClient::connect())</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none">User tokens other than Anonymous shall be transmitted in an encrypted way to ensure that the secret (e.g. password or user certificate) cannot be stolen.<br />
Clients should select an endpoint configuration, where either the entire message or the user token is encrypted or both, see <span class="f_FixedSize">UserAccessControlClient::connect()</span>.<br />
Security requires a trust relationship between the client and the server, thus the client must configure the certificate trust list, which contains the certificates of the trusted servers, see <span class="f_FixedSize">UserAccessControlClient::runClient().</span></td></tr></table></div><p class="p_Paragraph"><span class="f_Paragraph">Server:</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">When using user certificates for authentication, how to specify user certificate paths (user trust list location, and optional the user revocation list location). (See </span><span class="f_FixedSize">UserAccessControlServer::addEndpoints()</span><span class="f_Paragraph">)</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">How to handle the authentication of users with an inheriting class of <a href="class_softing_o_p_c_toolbox5_1_1_server_1_1_endpoint.htm" class="topiclink">Endpoint</a> and assigning them to user groups. (See </span><span class="f_FixedSize">SampleEndpoint::onAuthenticateUser()</span><span class="f_Paragraph">)</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Assign different roles to different users upon successful authentication.</span><br />
<span class="f_Paragraph">The Roles are stored on the session and are further used by the server to authorize access to the nodes in the address space (See also: <a href="html_serveruserauthorization.htm" class="topiclink">User Authorization</a>).</span><br />
<span class="f_Paragraph">For this sample the well-known Roles </span><span class="f_Paragraph" style="font-style: italic;">Anonymous</span><span class="f_Paragraph">, </span><span class="f_Paragraph" style="font-style: italic;">AuthenticatedUser</span><span class="f_Paragraph"> and </span><span class="f_Paragraph" style="font-style: italic;">Supervisor</span><span class="f_Paragraph"> are used.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none">Set access permissions on <a href="class_softing_o_p_c_toolbox5_1_1_server_1_1_variable.htm" class="topiclink">Variables</a> or <a href="class_softing_o_p_c_toolbox5_1_1_server_1_1_method.htm" class="topiclink">Methods</a> to grant or deny the access for different Roles. (See <span class="f_FixedSize">UserAccessControlServer::initAddressSpace()</span>).</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none">Some variables are visible only for the <span class="f_Paragraph" style="font-style: italic;">AuthenticatedUser </span>Role. As this Role is assigned to the session for all users and administrator, these variables will not be visible for anonymous user. (See <span class="f_FixedSize">EnumPermissionType_Browse</span> in<span class="f_Paragraph"> <a href="_enums_8h_1a77e61cdae0acf54f27e7c0545112c021.htm" class="topiclink">EnumPermissionType</a></span>).</td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none">User tokens other than Anonymous shall be transmitted in an encrypted way to ensure that the secret (e.g. password or user certificate) cannot be stolen.<br />
Servers should configure the <span class="f_Paragraph">related <a href="class_softing_o_p_c_toolbox5_1_1_user_identity_token.htm" class="topiclink">UserIdentityTokens</a> </span>with a user token security or configure a message security or both, see <span class="f_FixedSize">UserAccessControlServer::addEndpoint()</span>.<br />
Security requires a trust relationship between the client and the server, thus the server must configure the certificate trust list (other than the trusted user certificates), which contains the certificates of the trusted clients, see <span class="f_FixedSize">UserAccessControlServer::runServer()</span>.</td></tr></table></div><h3 class="p_Heading3"><span class="f_Heading3">Note:</span></h3>
<p class="p_Paragraph"><span class="f_Paragraph">In this sample both client and server use the same store for user certificates.</span><br />
<span class="f_Paragraph">In real world the stores would be at different locations and an administrator would need to distribute certificates or set up a Certificate Authority (CA) for signing certificates. </span></p>
<p class="p_Paragraph"><span class="f_Paragraph">&nbsp;</span></p>

      </td>
  </tr>
  <tr>
    <td colspan="2" style="padding-top: 0px;">
         <p>
            <hr />
            <a href="mailto:support.automation@softing.com?subject=OPC UA C++ Server &amp; Client SDK V6.00 Documentation Feedback:Page=html_sampleuseraccesscontrol.htm">Send comments on this topic.</a>
         </p>
         <p>
            Copyright © Softing Industrial Automation GmbH&nbsp;2022
         </p>
    </td>
  </tr>
</table>
</body>
</html>
