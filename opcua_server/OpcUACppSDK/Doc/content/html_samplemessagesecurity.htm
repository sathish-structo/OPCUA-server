<!DOCTYPE HTML>
<html>
<head>
   <title>Secure Communication</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "html_samplemessagesecurity.htm");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body style="margin: 0px 0px 0px 0px; background: #FFFFFF;">

<table width="100%" border="0" cellspacing="0" cellpadding="10">
  <tr valign="middle" bgcolor="#99CCFF">
    <td>
      <p>
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td style="vertical-align:middle;">
              <p style="font-family:Verdana; font-size:9pt; font-style:italic;">OPC UA C++ Server &amp; Client SDK V6.00</p>
              <p style="font-family:Verdana; font-size:9pt; font-weight:bold;">Secure Communication</p>
            </td>
          </tr>
        </table>
      </p>
    </td>
    <td align="right">
     <span style="font-size: 9pt">
     <a href="html_welcome.htm">Top</a>&nbsp;
     <a href="html_programming_samples.htm">Previous</a>&nbsp;
     <a href="html_samplediscoveryservice.htm">Next</a>
     </span>
    </td>
  </tr>
  <tr bgcolor="white">
      <td colspan="2">
          <p class="p_Paragraph"><a id="hdr"></a><span class="f_Paragraph">This sample shows how secure communication can be configured and established.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">It contains a server and a client application which use secure communication.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">The principles of a secure communication is:</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">The client sends its application instance certificate to the server on establishing the connection.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">The server validates the certificate, i.e. either the certificate itself is in the list of trusted certificates or the signing certificate authority (CA) is in that list.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">The server can restrict connections to only one network interface / IP address.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">The client application certificate is used to sign or encrypt the message.</span></td></tr></table></div><p class="p_Paragraph"><span class="f_Paragraph">See <a href="html_uasecuritymodel.htm" class="topiclink">Security</a> for further information.</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Both client and Server can create or connect with endpoints using IPv6 and/or the https protocol. For detailed information of IPv6 or Https protocol see <a href="html_programmersguide_httpstransportprotocol.htm" class="topiclink">Https Transport Protocol</a> or <a href="html_programmersguide_internetprotocolversion6.htm" class="topiclink">Internet Protocol version 6</a>.</span></td></tr></table></div><p class="p_Paragraph"><span class="f_NoteHeader">Note:</span><span class="f_Paragraph"> IPv6 is currently not supported for VxWorks, so neither a server can open an endpoint restricted to an IPv6 address, nor a client can connect to an IPv6 endpoint.</span></p>
<p class="p_NoteHeader"><span class="f_NoteHeader">Note:</span><span class="f_Paragraph"> The sample applications also demonstrate the use of configuration files (see <a href="application_configuration_file.htm" class="topiclink">Application Configuration File</a>). None the less, all settings are also configurable by code.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">&nbsp;</span></p>
<h3 class="p_Heading3"><span class="f_Heading3">Where to Find</span></h3>
<p class="p_Paragraph"><span class="f_Paragraph">The sample projects are located in the directory: &quot;</span><span class="f_FixedSize">&lt;InstallDir&gt;/Apps/Samples/Cpp/MessageSecurity</span><span class="f_Paragraph">&quot;. The client is in the subdirectory &quot;</span><span class="f_FixedSize">MessageSecurityClient</span><span class="f_Paragraph">&quot; and the server is in the &quot;</span><span class="f_FixedSize">MessageSecurityServer</span><span class="f_Paragraph">&quot; subdirectory.</span></p>
<h3 class="p_Heading3"><span class="f_Heading3">Running the Sample</span></h3>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">The client and server need existing application instance certificates and configurations files at the expected locations. See <a href="html_setupcertificates.htm" class="topiclink">Setting up a Certificate Store</a> for how to create the demo certificate store.</span><br />
<span class="f_Paragraph">The paths to the configuration file is specified at the top of </span><span class="f_FixedSize">MessageSecurityServer.cpp</span><span class="f_Paragraph"> and </span><span class="f_FixedSize">MessageSecurityClient.cpp</span><span class="f_Paragraph">, the paths to the certificate files are stored in the configuration files. Adapt the file paths if they don't fit.</span><br />
<span class="f_NoteHeader">Note:</span><span class="f_Paragraph"> On VxWorks only absolute paths are allowed inside the configuration files. Adapt the file paths to be able to start the sample applications.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Compile and start the sample applications </span><span class="f_Reference">MessageSecurityClient</span><span class="f_Paragraph"> and </span><span class="f_Reference">MessageSecurityServer</span><span class="f_Paragraph">. Run the application of interest in the debugger and step through the code.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">The server configuration file configures 4 endpoints, each two endpoints for IPv4 and IPv6, combined with opc.tcp binary protocol and on the https binary protocol.</span><br />
<span class="f_Paragraph">By default only the IPv4 endpoints are opened. By typing the command &quot;ipv6&quot; the server closes the existing endpoints and opens the endpoints for IPv6. To switch back to the default, type the command &quot;ipv4&quot;.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Type on the client the command &quot;co&quot; (connect) followed by a number to establish a connection with a certain message security mode for the endpoint on IPv4 with opc.tcp. Disconnect with the command &quot;di&quot; to be able to connect again with another message security mode.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">For the three other endpoints of the server use &quot;coipv6 &lt;mode&gt;&quot;, &quot;cohttps &lt;mode&gt;&quot; or &quot;cohttpsipv6 &lt;mode&gt;&quot;. These commands do the same as the &quot;co&quot; using IPv6 and/or HTTPS protocol.</span></td></tr></table></div><h3 class="p_Heading3"><span class="f_Heading3">Points of Interest</span></h3>
<p class="p_Paragraph"><span class="f_Paragraph">Client:</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">How to use a configuration file to configure the common client application settings.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Setting additional certificate locations to accept or deny server certificates. (See </span><span class="f_FixedSize">Client.Config.xml</span><span class="f_Paragraph">)</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">How to select and connect to a secure <a href="class_softing_o_p_c_toolbox5_1_1_server_1_1_endpoint.htm" class="topiclink">Endpoint</a> (see </span><span class="f_FixedSize">MessageSecurityClient::connect()</span><span class="f_Paragraph">). It is almost the same procedure as connecting to an <a href="class_softing_o_p_c_toolbox5_1_1_server_1_1_endpoint.htm" class="topiclink">Endpoint</a> without security.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">The notation of the server URLs can be found here: </span><span style="font-size: 10pt; font-family: Consolas;">g_serverUrlIPv4, g_serverUrlIPv6, g_serverUrlHttpsIPv4 and g_serverUrlHttpsIPv6</span><span class="f_Paragraph">. To </span><span style="font-size: 10pt;">be compatible, the localhost or Loopback ([::1])address is used. An Example for a real address is shown in a comment next to the declaration of the strings.</span></td></tr></table></div><p class="p_Paragraph"><span class="f_Paragraph">Server:</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">How to use a configuration file to configure the common server application settings.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Setting additional certificate locations to accept or deny client certificates. (See </span><span class="f_FixedSize">Server.Config.xml</span><span class="f_Paragraph">)</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Adding <a href="class_softing_o_p_c_toolbox5_1_1_server_1_1_endpoint.htm" class="topiclink">Endpoints</a> with different security configurations for signing or signing and encrypting messages on different security policies (See </span><span class="f_FixedSize">Server.Config.xml</span><span class="f_Paragraph">).</span><br />
<span class="f_Paragraph">It is almost the same as configuring an <a href="class_softing_o_p_c_toolbox5_1_1_server_1_1_endpoint.htm" class="topiclink">Endpoint</a> without security configuration.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">The client sends its application instance certificate to the server on establishing the connection.</span><br />
<span class="f_Paragraph">The server validates the certificate, i.e. either the certificate itself is in the list of trusted certificates or the signing certificate authority (CA) is in that list.</span><br />
<span class="f_Paragraph">The client application certificate is used to sign or encrypt the message.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">By default the server allows connections on all interfaces, i.e. even if &quot;localhost&quot; (127.0.0.1) is specified in the endpoint, a client can connect also to a real network interface using a different IP address, especially if the client is running on a different machine.</span><br />
<span class="f_Paragraph">The endpoint can be restricted to allow connections only on the specified interface (host / IP part in its url), by calling the method <a href="class_softing_o_p_c_toolbox5_1_1_server_1_1_endpoint.htm#class_softing_o_p_c_toolbox5_1_1_server_1_1_endpoint_1ab19acecd9db2e886233f0cf16dfbd4cc" class="topiclink">Server::Endpoint::setRestrictToSingleInterface()</a> with a the parameter set to true. </span><br />
<span class="f_Paragraph">In this case only clients on the local machine (using &quot;localhost&quot;) can connect to this server unless the specified URL is adapted to a real interface.</span><br />
<span class="f_Paragraph">With this restriction it is also possible to respect regulations for firewall, etc.</span><br />
<span class="f_Paragraph">This sample server restricts all endpoints that use IP addresses, while any endpoints using hostnames are open for all interfaces.</span><br />
<span class="f_Paragraph">You can modify the URLs in </span><span class="f_FixedSize">Server.Config.xml</span><span class="f_Paragraph"> to test the different behaviors.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 0px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">The notation of the endpoint URLs can be found in </span><span class="f_FixedSize">Server.Config.xml</span><span class="f_Paragraph">. To be compatible, the IPs of the Loopback adapters 127.0.0.1 and [::1] are used. An Example for a real address is shown in a comment next to the declaration of the strings.</span></td></tr></table></div>
      </td>
  </tr>
  <tr>
    <td colspan="2" style="padding-top: 0px;">
         <p>
            <hr />
            <a href="mailto:support.automation@softing.com?subject=OPC UA C++ Server &amp; Client SDK V6.00 Documentation Feedback:Page=html_samplemessagesecurity.htm">Send comments on this topic.</a>
         </p>
         <p>
            Copyright © Softing Industrial Automation GmbH&nbsp;2022
         </p>
    </td>
  </tr>
</table>
</body>
</html>
