<!DOCTYPE HTML>
<html>
<head>
   <title>Enumerating UA Servers</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "html_samplediscoveryservice.htm");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body style="margin: 0px 0px 0px 0px; background: #FFFFFF;">

<table width="100%" border="0" cellspacing="0" cellpadding="10">
  <tr valign="middle" bgcolor="#99CCFF">
    <td>
      <p>
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td style="vertical-align:middle;">
              <p style="font-family:Verdana; font-size:9pt; font-style:italic;">OPC UA C++ Server &amp; Client SDK V6.00</p>
              <p style="font-family:Verdana; font-size:9pt; font-weight:bold;">Enumerating UA Servers</p>
            </td>
          </tr>
        </table>
      </p>
    </td>
    <td align="right">
     <span style="font-size: 9pt">
     <a href="html_welcome.htm">Top</a>&nbsp;
     <a href="html_samplemessagesecurity.htm">Previous</a>&nbsp;
     <a href="html_samplelimitedresources.htm">Next</a>
     </span>
    </td>
  </tr>
  <tr bgcolor="white">
      <td colspan="2">
          <p class="p_Paragraph"><a id="hdr"></a><span class="f_Paragraph">An UA Local Discovery Server (LDS) is a process on a machine where running UA servers on that machine can be enumerated.</span><br />
<span class="f_Paragraph">The LDS is listening on the well-known port 4840 to accept requests.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">OPC Foundation provides a LDS for Windows. The LDS is installed as a part of the Windows setup of OPC UA C++ Server &amp; Client SDK V6.00.</span><br />
<span class="f_Paragraph">For Linux or VxWorks no LDS is available at the moment.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">For machines where only one OPC UA server shall run, a LDS is not required at all.</span><br />
<span class="f_Paragraph">The server itself can use the well-known port 4840 since all OPC UA servers have to implement the discovery services for self-discovery.</span><br />
<span class="f_Paragraph">The OPC UA C++ Server &amp; Client SDK V6.00 implements these self-discovery services for server applications automatically.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">In the sample project &quot;Discoverable Server&quot; we demonstrate how to register a server to the UA discovery server and in the client project &quot;test discoverable server&quot; how to fetch the server and connect it through of the UA discovery server.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">This sample does not work on VxWorks and Linux!</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">For further information see <a href="html_uaservicesdiscovery.htm" class="topiclink">Discovery</a>.</span></p>
<h3 class="p_Heading3"><span class="f_Heading3">Where to Find</span></h3>
<p class="p_Paragraph"><span class="f_Paragraph">The projects for this sample are located in the directory: &quot;</span><span class="f_FixedSize">&lt;InstallDir&gt;/Apps/Samples/Cpp/DiscoveryService</span><span class="f_Paragraph">&quot;. While the subdirectory &quot;</span><span class="f_FixedSize">DiscoverableServer</span><span class="f_Paragraph">&quot; contains source for the server, the client project for the test can be found in &quot;</span><span class="f_FixedSize">TestDiscoverableServer</span><span class="f_Paragraph">&quot; subdirectory.</span></p>
<h3 class="p_Heading3"><span class="f_Heading3">Running the Sample</span></h3>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">The client and server need an existing application instance certificate and it must be in the correct directory. See <a href="html_setupcertificates.htm" class="topiclink">Setting up a Certificate Store</a> for how to create the demo certificate store. The path to the certificate is specified at the top of </span><span class="f_FixedSize">DiscoverableServer.cpp </span><span class="f_Paragraph">and</span><span class="f_FixedSize"> TestDiscoverableServer.cpp</span><span class="f_Paragraph">, adapt it if it doesn't fit.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Compile and start the sample applications </span><span class="f_Reference">DiscoverableServer</span><span class="f_Paragraph"> and </span><span class="f_Reference">TestDiscoverableServer</span><span class="f_Paragraph">. Run the server application in the debugger and step through the code.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 0px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Use the command &quot;t&quot;on the client application to test, whether the server can be found via the LDS.</span></td></tr></table></div><h3 class="p_Heading3"><span class="f_Heading3">Points of Interest</span></h3>
<p class="p_Paragraph"><span class="f_Paragraph">Client:</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">How to find UA servers on a machine using </span><span class="f_Paragraph"> </span><a href="class_softing_o_p_c_toolbox5_1_1_application.htm#class_softing_o_p_c_toolbox5_1_1_application_1a73a81690bbc5b78c6bdfef604d1466d5" class="topiclink">Application::findServers()</a><span class="f_Paragraph">.</span><br />
<span class="f_Paragraph">The result of this call is a list of <a href="class_softing_o_p_c_toolbox5_1_1_application_description.htm" class="topiclink">application descriptions</a> of running UA servers.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">How to retrieve the endpoints for a server using </span> <a href="class_softing_o_p_c_toolbox5_1_1_application.htm#class_softing_o_p_c_toolbox5_1_1_application_1a9027456301c1ec668d59bd44d8fac918" class="topiclink">Application::getEndpointsFromServer()</a><span class="f_Paragraph">.</span></td></tr></table></div><p class="p_Paragraph"><span class="f_Paragraph">Server:</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Specify the application instance certificate of the LDS using <a href="class_softing_o_p_c_toolbox5_1_1_application.htm#class_softing_o_p_c_toolbox5_1_1_application_1a923d578abffbe8b5476a32cbb08f78cd" class="topiclink">Application::loadDiscoveryServerCertificate()</a>.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Enabling the registration on the LDS using <a href="class_softing_o_p_c_toolbox5_1_1_application.htm#class_softing_o_p_c_toolbox5_1_1_application_1a11670739c41d8cda2c28e621d5baf2ee" class="topiclink">Application::enableServerRegistration()</a>.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 13px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Courier New';color:#000000;">o</span></td><td style="border:none"><span class="f_Paragraph">When registration is enabled the server will try to register with the Discovery Server by using the </span><span class="f_Paragraph" style="font-style: italic;">RegisterServer2</span><span class="f_Paragraph"> service. If this service is not supported it will fall back to using </span><span class="f_Paragraph" style="font-style: italic;">RegisterServer</span><span class="f_Paragraph">.</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 13px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Courier New';color:#000000;">o</span></td><td style="border:none"><span class="f_Paragraph">RegisterServer2 service is invoked using one discovery configuration with an empty Server name (first element of the serverNames array is used). The </span><span class="f_Paragraph" style="font-style: italic;">serverCapabilities</span><span class="f_Paragraph"> argument of the <a href="class_softing_o_p_c_toolbox5_1_1_application.htm#class_softing_o_p_c_toolbox5_1_1_application_1a11670739c41d8cda2c28e621d5baf2ee" class="topiclink">Application::enableServerRegistration()</a> method allows application developers to specify the set of Server capabilities supported by the Server. Capability identifiers are short strings that map onto a subset of OPC UA features. Application developers should consider using the normative set of ServerCapabilityIdentifiers published by the OPC Foundation: <a href="http://www.opcfoundation.org/UA/schemas/1.04/ServerCapabilities.csv" target="_blank" class="weblink">http://www.opcfoundation.org/UA/schemas/1.04/ServerCapabilities.csv</a> (see also the table in the &quot;Note&quot; section below).</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Arial Unicode MS','Lucida Sans Unicode','Arial';color:#000000;">&#8226;</span></td><td style="border:none"><span class="f_Paragraph">Steps to enable LDS registration for a server application:</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 13px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Verdana';color:#000000;">1.</span></td><td style="border:none"><span class="f_Paragraph"> Prepare settings for discovery service (URL of the discovery server, discovery server's application instance certificate, registration refresh period);</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 13px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Verdana';color:#000000;">2.</span></td><td style="border:none"><span class="f_Paragraph"> Set a minimal PKI store configuration. The path to the folder containing trusted certificates should be </span><span class="f_Paragraph">provided (</span><a href="class_softing_o_p_c_toolbox5_1_1_i_pki_store_configuration.htm#class_softing_o_p_c_toolbox5_1_1_i_pki_store_configuration_1ae446a7f5110b5ab533382e31699bd023" class="topiclink">IPkiStoreConfiguration::setCertificateTrustListLocation</a><span class="f_Paragraph">)</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 13px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Verdana';color:#000000;">3.</span></td><td style="border:none"><span class="f_Paragraph" style="font-weight: bold;"> Configure settings for discovery URLs;</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 13px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Verdana';color:#000000;">4.</span></td><td style="border:none"><span class="f_Paragraph"> Specify the application instance certificate of the LDS;</span></td></tr></table></div><div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 13px;"><table border="0" cellpadding="0" cellspacing="0" style="border:none;border-spacing:0px;padding:0px;line-height: normal;"><tr valign="baseline" style="vertical-align:baseline"><td style="border:none;width:13px"><span style="font-size:9pt; font-family: 'Verdana';color:#000000;">5.</span></td><td style="border:none"><span class="f_Paragraph"> Enable the registration of the server with a discovery server.</span></td></tr></table></div><h3 class="p_Heading3"><span class="f_Heading3">Note:</span></h3>
<p class="p_Paragraph"><span class="f_Paragraph">To run this sample properly, the LDS from OPC Foundation must be installed and running.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">The sample server (</span><span class="f_FixedSize">DiscoverableServer</span><span class="f_Paragraph">) will not fail to start if LDS registration fails. Verify the trace log for any errors.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">Registration at the LDS requires a secure communication. Therefore the sample server must be trusted by the LDS.</span><br />
<span class="f_Paragraph">This can be achieved by executing the script </span><span class="f_FixedSize">update_discovery_server_store.bat</span><span class="f_Paragraph">.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">Please open a command shell and enter the commands depicted below.</span></p>
<p>On Microsoft Windows systems:</p>
<p class="p_CodeExample"><span class="f_CodeExample">&gt;&nbsp;cd&nbsp;&lt;InstallDir&gt;/Source/PKI</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&gt;&nbsp;update_discovery_server_store.bat</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">It is also possible to test the discoverable server using &quot;Softing OPC UA Client&quot; from &quot;Softing Industrial Automation GmbH&quot;.</span></p>
<p class="p_Paragraph"><span class="f_Paragraph">&nbsp;</span></p>
<p class="p_Paragraph"><span class="f_Paragraph" style="font-weight: bold;">Examples of ServerCapabilityIdentifiers</span></p>
<div style="text-align: left; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table style="border:none; border-spacing:0px; border-collapse:collapse;">
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>NA</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>No capability information is available. Cannot be used in combination with any other capability</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>DA</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Provides current data.</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>HD</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Provides historical data.</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>AC</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Provides alarms and conditions that may require operator interaction.</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>HE</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Provides historical alarms and events.</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>GDS</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Supports the Global Discovery Server information model.</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>LDS</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Only supports the Discovery Services. Cannot be used in combination with any other capability.</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>DI</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Supports the Device Integration (DI) information model</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>ADI</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Supports the Analyser Device Integration (ADI) information model</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>FDI</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Supports the Field Device Integration (FDI) information model</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>FDIC</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Supports the Field Device Integration (FDI) Communication Server information model</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>PLC</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Supports the PLCopen information model</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>S95</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Supports the ISA95 information model</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>RCP</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Supports the reverse connect capabilities</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>PUB</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Supports the Publisher capabilities</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; width:104px; padding:3px; border:solid 1px #000000;"><p>SUB</p>
</td>
<td style="vertical-align:top; width:741px; padding:3px; border:solid 1px #000000;"><p>Supports the Subscriber capabilities</p>
</td>
</tr>
</table>
</div>

      </td>
  </tr>
  <tr>
    <td colspan="2" style="padding-top: 0px;">
         <p>
            <hr />
            <a href="mailto:support.automation@softing.com?subject=OPC UA C++ Server &amp; Client SDK V6.00 Documentation Feedback:Page=html_samplediscoveryservice.htm">Send comments on this topic.</a>
         </p>
         <p>
            Copyright © Softing Industrial Automation GmbH&nbsp;2022
         </p>
    </td>
  </tr>
</table>
</body>
</html>
